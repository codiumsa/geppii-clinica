Bodega.views = Bodega.views || {};
//generated with inkscape
var stringSvg =
  '<svg' +
  '   xmlns:dc="http://purl.org/dc/elements/1.1/"' +
  '   xmlns:cc="http://creativecommons.org/ns#"' +
  '   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"' +
  '   xmlns:svg="http://www.w3.org/2000/svg"' +
  '   xmlns="http://www.w3.org/2000/svg"' +
  '   version="1.1"' +
  '   id="svg2"' +
  '   height="180"' +
  '   width="200">' +
  '  <defs' +
  '     id="defs4" />' +
  '  <metadata' +
  '     id="metadata7">' +
  '    <rdf:RDF>' +
  '      <cc:Work' +
  '         rdf:about="">' +
  '        <dc:format>image/svg+xml</dc:format>' +
  '        <dc:type' +
  '           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />' +
  '        <dc:title></dc:title>' +
  '      </cc:Work>' +
  '    </rdf:RDF>' +
  '  </metadata>' +
  '  <g' +
  '     id="layer1"' +
  '     transform="matrix(0.27274393,0,0,0.22063884,-1.7450773,1.05258)">' +
  '    <path' +
  '       id="path4866"' +
  '       d="m 691.95174,778.77648 c 0.7504,-14.71478 -3.37518,-49.23676 5.1847,-83.58734 8.70456,-34.93124 31.07753,-69.68521 31.14568,-83.25322 C 728.28187,427.20551 679.07084,261.95939 601.6596,151.81401 m -24.15973,-31.48773 c -5.97682,-7.12017 -12.08939,-13.93514 -18.32978,-20.43144 M 536.18752,77.926607 C 487.61026,35.463165 432.49238,11.487768 374.07115,11.488164 l 0,0 C 314.7706,11.488635 258.44419,36.497707 208.73814,80.590996 M 190.86357,97.55469 c -7.67493,7.77389 -15.1695,16.01647 -22.46888,24.70358 m -22.95682,29.68337 c -3.60909,5.06072 -5.78289,8.61955 -9.27284,13.90835 C 76.024102,256.98878 33.889553,381.47304 20.840322,521.2995 m -2.603257,30.02925 c -0.507001,7.36062 -1.080464,14.25819 -1.622881,21.01795 m -1.183903,29.48753 c -0.152518,4.32562 -0.239959,8.77693 -0.239959,13.42926 0.07761,15.9832 27.552829,49.06626 38.486825,84.95529 9.781946,32.10756 10.848277,65.84304 11.662308,80.69187"' +
  '       style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:8.35690784px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />' +
  '    <ellipse' +
  '       transform="matrix(0.9705368,0.24095293,-0.21263505,0.97713169,0,0)"' +
  '       ry="24.048027"' +
  '       rx="14.069408"' +
  '       cy="53.607964"' +
  '       cx="220.91138"' +
  '       id="path4883"' +
  '       style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:6.37595749;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />' +
  '    <ellipse' +
  '       transform="matrix(-0.9705368,0.24095293,0.21263505,0.97713169,0,0)"' +
  '       ry="24.048027"' +
  '       rx="14.069408"' +
  '       cy="227.08646"' +
  '       cx="-511.93851"' +
  '       id="path4883-3"' +
  '       style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:6.37595749;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />' +
  '    <ellipse' +
  '       transform="matrix(-0.9705368,0.24095293,0.21263505,0.97713169,0,0)"' +
  '       ry="24.048027"' +
  '       rx="14.069408"' +
  '       cy="274.75616"' +
  '       cx="-545.39056"' +
  '       id="path4883-5-5"' +
  '       style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:6.37595749;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />' +
  '    <ellipse' +
  '       transform="matrix(-0.9204634,-0.39082876,-0.34879722,0.93719822,0,0)"' +
  '       ry="23.92038"' +
  '       rx="14.152992"' +
  '       cy="478.91812"' +
  '       cx="-215.02815"' +
  '       id="path4883-3-6"' +
  '       style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:6.37787342;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />' +
  '    <ellipse' +
  '       transform="matrix(-0.91776158,-0.39713183,-0.35463405,0.93500518,0,0)"' +
  '       ry="23.913578"' +
  '       rx="14.157416"' +
  '       cy="523.53503"' +
  '       cx="-232.66818"' +
  '       id="path4883-5-5-2"' +
  '       style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:6.3779645;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />' +
  '    <ellipse' +
  '       transform="matrix(0.9204634,-0.39082876,0.34879722,0.93719822,0,0)"' +
  '       ry="23.92038"' +
  '       rx="14.152992"' +
  '       cy="741.36432"' +
  '       cx="486.96368"' +
  '       id="path4883-3-6-9"' +
  '       style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:6.37787342;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />' +
  '    <ellipse' +
  '       transform="matrix(0.91776158,-0.39713183,0.35463405,0.93500518,0,0)"' +
  '       ry="23.913578"' +
  '       rx="14.157416"' +
  '       cy="790.7207"' +
  '       cx="467.89011"' +
  '       id="path4883-5-5-2-1"' +
  '       style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:6.3779645;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />' +
  '    <ellipse' +
  '       transform="matrix(0.91776158,-0.39713183,0.35463405,0.93500518,0,0)"' +
  '       ry="23.913578"' +
  '       rx="14.157416"' +
  '       cy="838.86761"' +
  '       cx="450.89465"' +
  '       id="path4883-5-5-2-1-2"' +
  '       style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:6.3779645;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />' +
  '    <ellipse' +
  '       transform="matrix(0.9705368,0.24095293,-0.21263505,0.97713169,0,0)"' +
  '       ry="24.048027"' +
  '       rx="14.069408"' +
  '       cy="101.27759"' +
  '       cx="187.45956"' +
  '       id="path4883-5"' +
  '       style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:6.37595749;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />' +
  '  </g>' +
  '  <rect' +
  '     style="opacity:1;fill:#000000;fill-opacity:0.0;fill-rule:nonzero;stroke:none;stroke-width:0.966;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"' +
  '     id="rect5545"' +
  '     width="198.22665"' +
  '     height="175.45245"' +
  '     x="0.084382057"' +
  '     y="1.3903046" />' +
  '</svg>';

//TODO: pasar los parametros para dibujar el punto
//si existe el punto, que no sea editable? guardar historico?
Bodega.views.FistulaSVGView = Ember.View.extend({
  self: this,
  templateName: 'pacientes/fonoaudiologia/fistula_svg',
  didInsertElement: function(){
    if(this.get('controller').get('fistula')){
      //usando el valor seteado en el controllador, idealmente deberia ser pasado por el handlebar
      self.data = this.get('controller').get('fistula').svg;//Ember.get(self, 'data');
    }
    if(!self.data ||  self.data === ''){
      self.data = stringSvg;//draw = SVG('fistula_svg').svg(stringSvg).size(200,200);
    }

    var draw = SVG('fistula_svg').svg(self.data).size(200,200);
    draw.scale(1, 1);
    self.rect = SVG.get('rect5545');
    self.rect.dot = SVG.get('dot');

    var clickCallback = function(attr){
      if(!self.rect.dot){
	self.rect.dot = draw.circle(15).attr({id:'dot', fill: '#F3151C' });
      }
      self.rect.dot.cx(attr.clientX).cy(attr.clientY);
      self.rect.dot.transform(attr.target.getScreenCTM().inverse());
    };
    Object.keys(draw.node.children).forEach(function(key){
      draw.node.children[key].onclick = clickCallback;
    });
    self.draw = draw;
  },
  click: function(){
    //tight coupling not at good idea, anyways...
    this.get('controller').updateFistulaSVGData(self.draw.svg());
  }
});
